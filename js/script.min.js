const doc=document;var minDate="",dateValue="";const server_host="http://10.10.3.17:8000",host=server_host+"/request/common/common_handler/SqlQuery/sql_query?session=2";var user_info={};const checkOnlineStatus=async()=>{try{const e=await fetch("https://jsonplaceholder.typicode.com/todos/1");return e.status>=200&&e.status<300}catch(e){return!1}};setInterval((async()=>{const e=await checkOnlineStatus(),t=doc.getElementById("indicator"),n=doc.getElementById("header_indicator");t.style.filter=e?"invert(35%) sepia(84%) saturate(4801%) hue-rotate(125deg) brightness(102%) contrast(80%)":"invert(32%) sepia(80%) saturate(1418%) hue-rotate(335deg) brightness(78%) contrast(92%)",n.style.filter=e?"invert(35%) sepia(84%) saturate(4801%) hue-rotate(125deg) brightness(102%) contrast(80%)":"invert(32%) sepia(80%) saturate(1418%) hue-rotate(335deg) brightness(78%) contrast(92%)"}),5e3);var _xLen,_x,_lsTotal=0;for(_x in localStorage)localStorage.hasOwnProperty(_x)&&(_lsTotal+=_xLen=2*(localStorage[_x].length+_x.length));async function loginHTML(){var e='<style>.inner_container {max- width: 100 %;margin: 0 auto;}.login_wrapper {margin: auto;width: 100vw;height: 100vh;display: grid;grid-template-rows: auto auto auto;justify-content: center;background-color: #F2F2F2;}.network_status {padding-top: 20px;margin: 0 auto;}.network_status p {text - align: center;color: #27262a;}#indicator {width: 50px;filter: invert(96 %) sepia(89 %) saturate(29 %) hue - rotate(325deg) brightness(110 %) contrast(2 %);}.login_form {display: flex;flex-direction: column;width: 280px;}.login_form p {margin: 0px;font-weight: 400;font-size: 20px;line-height: 28px;display: flex;color: #27262a;}.login_form input {height: 60px;margin: 10px 0px 10px 0px;border: 1px solid #eaeaea;border-radius: 5px;padding-left: 20px;font-style: normal;font-weight: 500;font-size: 20px;line-height: 37px;color: #27262a;}#error_login_text {display: none;font-style: italic;font-weight: 400;font-size: 16px;line-height: 18px;color: #C03434;margin-top: 5px;margin-bottom: 0px;}.login_form button {margin-top: 40px;height: 60px;background: #fbfbfb;border-radius: 5px;color: #27262a;font-weight: 500;font-size: 20px;line-height: 28px;border: 1px solid #eaeaea;box-shadow: 0px 1px #d4d4d4;cursor: pointer;}.login_form button:hover {border: none;background-color: #0363c3;box-shadow: 0px 1px #003b87;color: #fbfbfb;}.login_footer {position: fixed;bottom: 0px;text-align: center;width: 100 %;}</style> <div id="login_wrapper" class="login_wrapper"><div id="network_status" class="network_status"><img id="indicator" src="img/network.svg" alt=""></div><div class="login_form"><p>Табельный номер</p><input id="tab_num" type="text" inputmode="none" placeholder="Табельный номер..."><p>Пароль</p><input id="password" type="text" inputmode="none" placeholder="Пароль..."><div id="error_login_text" class="error_login_text">Табельный номер или пароль указан неверно</div><button onclick="log_in()">Войти</button></div></div></div>';localStorage.setItem("loginHTML",e),document.getElementById("wrapper").innerHTML=e}function log_in(){var e=document,t=e.getElementById("tab_num").value,n=e.getElementById("password").value,o=localStorage.getItem(t);null==o&&add_user(t),null!=o&&(JSON.parse(o).pass==n?menuHTML(o):(console.log(JSON.parse(o).pass),e.getElementById("error_login_text").style.display="block"))}function add_user(e){console.log("ADD USER TO LOCAL STORAGE");var t={function:"fetch",query:"select * from total.v_user_to_menu a where a.arm_name = 'ТСД' and a.tabnum =  '"+e+"'"};fetch(host,{method:"POST",body:JSON.stringify(t)}).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)})).then((t=>{console.log(t),user_info.username=t[0].username,user_info.pass=t[0].pass,user_info.group_name=t[0].group_name;for(let e=0;e<t.length;e++){var n=t[e].menu_name;"Обновление ТСД"==n&&(user_info.update=t[e].menu_name),"Просмотр"==n&&(user_info.view=t[e].menu_name),"Удаление после отправки"==n&&(user_info.del_after=t[e].menu_name),"Удаление до отправки"==n&&(user_info.del_befor=t[e].menu_name),"Добавить"==n&&(user_info.add=t[e].menu_name)}localStorage.setItem(e,JSON.stringify(user_info)),log_in()})).catch((e=>{console.log(e),alert("Подльзователь не зарегистрирован")}))}function changeDate(){doc.getElementById("scaner").innerHTML="",doc.getElementById("main_menu").innerHTML="";const e=doc.getElementById("dateWrapper");e.innerHTML="";const t=doc.createElement("input");t.type="date",t.id="dateId",t.value=dateValue.join("-"),t.setAttribute("min",dateValue.join("-")),e.appendChild(t);const n=doc.createElement("button");n.className="_btn",n.textContent="Применить",n.addEventListener("click",(function(){dateValue=doc.getElementById("dateId").value.split("-"),changeDateCalendar(),e.innerHTML=""})),e.appendChild(n),doc.getElementById("dateId").focus()}console.log("Total = "+(_lsTotal/1024).toFixed(2)+" KB"),loginHTML(),localStorage.clear();var jsonMenu={menu:{add_prod:"Добавить в оборот",dell_prod:"Вывести из оборота",check:"Проверка штрих-кода",update:"Обновить терминал"}};function menu(){doc.getElementById("dateWrapper").innerHTML="",doc.getElementById("scaner").innerHTML="",doc.getElementById("codes_list").innerHTML="";const e=doc.getElementById("main_menu");for(var t in e.innerHTML="",jsonMenu.menu){var n=doc.createElement("button");n.className="_btn",n.id=t,n.textContent=jsonMenu.menu[t],n.addEventListener("click",(function(){var e=doc.getElementById(event.target.id).textContent;doc.getElementById("operation_type").textContent=e,scanLine()})),e.appendChild(n)}}function LogOut(){doc.getElementById("dateWrapper").innerHTML="",doc.getElementById("main_menu").innerHTML="",doc.getElementById("scaner").innerHTML="",doc.getElementById("codes_list").innerHTML="",doc.getElementById("login_wrapper").style.display="grid",doc.getElementById("tab_num").focus()}function menuHTML(e){doc.getElementById("error_login_text").style.display="none",e=JSON.parse(e),console.log(e);doc.getElementById("wrapper").innerHTML='<div class="inner_container"><div id="bar_info" class="bar_info"><p>Отдел: <span id="department">-</span></p><p>Тип операции: <span id="operation_type">-</span></p><p class="num_line">№ линии: <span id="num_line">-</span></p></div><div id="dateWrapper"></div><div id="main_menu_wrapper" class="main_menu_wrapper"><div id="main_menu" class="main_menu"></div></div></div>',doc.getElementById("department").textContent=e.group_name}function saveInlocalStorage(e){localUsers(),console.log(localStorage.getItem("users")),addLocalStorage(e)}function addLocalStorage(e){localStorage.setItem(e,e),allStorage()}function allStorage(){for(var e=[],t=Object.keys(localStorage),n=t.length;n--;)"users"!=t[n]&&e.push(localStorage.getItem(t[n]));console.log(e)}function formatDate(e){var t=new Date(e),n=""+(t.getMonth()+1),o=""+t.getDate(),a=t.getFullYear();return n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),[a,n,o]}function startDate(){const e=Date.now();minDate=formatDate(e),dateValue=minDate,changeDateCalendar()}function changeDateCalendar(){doc.getElementById("calendar-date").textContent=dateValue[2]+"."+dateValue[1]+"."+dateValue[0]}function scanLine(){doc.getElementById("main_menu").innerHTML="",doc.getElementById("scaner").innerHTML="";const e=doc.createElement("div");e.id="scanerDiv",e.className="scanerDiv";var t=doc.createElement("span");t.className="help_text",t.textContent="Отсканируйте номер линии";const n=doc.createElement("input");n.type="text",n.id="scaner_field",n.setAttribute("inputmode","none"),e.appendChild(t),e.appendChild(n);doc.getElementById("scaner").appendChild(e),doc.getElementById("scaner_field").focus(),checkLine()}function checkLine(){doc.getElementById("scaner_field").addEventListener("keydown",logKey)}function logKey(e){if("Enter"==e.key){var t=document.getElementById("scaner_field").value;doc.getElementById("num_line").textContent=t,doc.getElementById("scaner_field").value="",scanerCod()}}function scanerCod(){doc.getElementById("main_menu").innerHTML="",doc.getElementById("scaner").innerHTML="";const e=doc.createElement("div");e.id="scanerDiv",e.className="scanerDiv";var t=doc.createElement("span");t.className="help_text",t.textContent="Отсканируйте штрих-код";const n=doc.createElement("input");n.type="text",n.id="scaner_field",n.setAttribute("inputmode","none"),e.appendChild(t),e.appendChild(n);doc.getElementById("scaner").appendChild(e),doc.getElementById("scaner_field").focus(),checkCod()}function checkCod(){doc.getElementById("scaner_field").addEventListener("keydown",logKeyCode)}function logKeyCode(e){if("Enter"==e.key){var t=document.getElementById("scaner_field").value;doc.getElementById("scaner_field").value="",showInfoCod(t)}}function showInfoCod(e){console.log(e);var t=doc.createElement("div");t.className="cod_div_info";var n=doc.createElement("span");n.textContent="Штрих-код: "+e,t.appendChild(n);doc.getElementById("codes_list").appendChild(t),saveInlocalStorage(e)}function test(){localStorage.setItem("loginHTML","<style>.inner_container {max- width: 100 %;margin: 0 auto;}.login_wrapper {margin: auto;width: 100vw;height: 100vh;display: grid;grid - template - rows: auto auto auto;justify - content: center;background - color: #F2F2F2;}.network_status {padding - top: 20px;margin: 0 auto;}.network_status p {text - align: center;color: #27262a;}#indicator {width: 50px;filter: invert(96 %) sepia(89 %) saturate(29 %) hue - rotate(325deg) brightness(110 %) contrast(2 %);}.login_form {display: flex;flex - direction: column;width: 280px;}.login_form p {margin: 0px;font - weight: 400;font - size: 20px;line - height: 28px;display: flex;color: #27262a;}.login_form input {height: 60px;margin: 10px 0px 10px 0px;border: 1px solid #eaeaea;border - radius: 5px;padding - left: 20px;font - style: normal;font - weight: 500;font - size: 20px;line - height: 37px;color: #27262a;}#error_login_text {display: none;font - style: italic;font - weight: 400;font - size: 16px;line - height: 18px;color: #C03434;margin - top: 5px;margin - bottom: 0px;}.login_form button {margin - top: 40px;height: 60px;background: #fbfbfb;border - radius: 5px;color: #27262a;font - weight: 500;font - size: 20px;line - height: 28px;border: 1px solid #eaeaea;box - shadow: 0px 1px #d4d4d4;cursor: pointer;}.login_form button:hover {border: none;background - color: #0363c3;box - shadow: 0px 1px #003b87;color: #fbfbfb;}.login_footer {position: fixed;bottom: 0px;text - align: center;width: 100 %;}</style> ")(console.log(localStorage.getItem("loginHTML")))}